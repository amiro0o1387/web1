<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ Ù„Ø§Ú¯ÛŒÙ† â€” Ù†Ø³Ø®Ù‡ ØªÚ©â€ŒÙØ§ÛŒÙ„</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#f0f8ff;
  --accent:#0066cc;
  --accent-2:#00897b;
  --card:#ffffff;
  --muted:#7b8794;
  --danger:#d32f2f;
  --glass: rgba(255,255,255,0.65);
}

/* Reset and base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:"Vazirmatn",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; background: linear-gradient(135deg,#eaf6ff,#ffffff); color:#0b1220; -webkit-font-smoothing:antialiased}
a{color:var(--accent);text-decoration:none}
.container{max-width:1100px;margin:28px auto;padding:18px}

/* Layout */
.app {
  display:grid;
  grid-template-columns: 420px 1fr;
  gap:28px;
  align-items:start;
  min-height: calc(100vh - 56px);
}
@media (max-width:900px){
  .app{grid-template-columns:1fr;padding:14px}
}

/* Left card: forms */
.panel {
  background: linear-gradient(180deg, rgba(255,255,255,0.85), var(--glass));
  border-radius:16px;
  padding:22px;
  box-shadow: 0 10px 30px rgba(2,6,23,0.08);
  backdrop-filter: blur(6px);
  border: 1px solid rgba(10,20,40,0.06);
  position:relative;
  overflow:hidden;
}

/* Header */
.header {
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:12px;
}
.logo {
  width:58px;height:58px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px;box-shadow:0 8px 24px rgba(2,6,23,0.08)
}
.header h1{margin:0;font-size:18px}
.header p{margin:0;color:var(--muted);font-size:13px}

/* Tabs */
.tabs {display:flex;gap:8px;margin:16px 0}
.tab-btn {
  background:transparent;border:0;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer;color:var(--muted)
}
.tab-btn.active{
  background: linear-gradient(90deg,var(--accent),var(--accent-2));
  color:white;box-shadow:0 6px 18px rgba(0,130,140,0.12)
}

/* Forms */
.form {display:none}
.form.active{display:block}
.field {margin-bottom:12px}
label{display:block;margin-bottom:6px;font-size:13px;color:var(--muted)}
.input {
  width:100%;padding:12px;border-radius:10px;border:1px solid rgba(12,20,30,0.08);font-size:14px;background:white;outline:none
}
.input:focus{box-shadow:0 6px 18px rgba(0,120,215,0.06);border-color:rgba(0,120,215,0.15)}
.row{display:flex;gap:8px}
.small{font-size:13px;color:var(--muted)}

/* Buttons */
.btn {
  display:inline-block;padding:11px 18px;border-radius:10px;border:0;background:var(--accent-2);color:white;font-weight:600;cursor:pointer;width:100%;font-size:15px;
  transition:transform .12s ease,box-shadow .12s ease;
}
.btn:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(0,120,140,0.12)}
.btn.ghost{background:transparent;color:var(--accent);border:1px dashed rgba(0,100,200,0.08)}
.link-muted{color:var(--muted);font-size:13px;margin-top:8px}

/* Strength meter */
.strength {
  height:10px;border-radius:8px;background:#f1f5f9;overflow:hidden;margin-top:6px;border:1px solid rgba(0,0,0,0.03)
}
.strength > i{display:block;height:100%;width:0;transition:width .28s ease;background:linear-gradient(90deg,#ff7a18,#ffd200)}

.hints{margin-top:8px;font-size:13px;color:var(--muted)}

/* Right content area */
.main {
  background: linear-gradient(180deg,#fff,#fbfdff);
  border-radius:16px;padding:28px;box-shadow:0 10px 30px rgba(2,6,23,0.06);border:1px solid rgba(10,20,40,0.04)
}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.user-info{display:flex;align-items:center;gap:12px}
.avatar{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,#ffd89b,#19547b);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px}
.welcome h2{margin:0;font-size:18px}
.welcome p{margin:0;color:var(--muted);font-size:13px}

/* Profile card */
.card{background:white;padding:18px;border-radius:12px;border:1px solid rgba(10,20,40,0.03);margin-top:12px}
.card h3{margin:0 0 8px 0}
.action-row{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}

/* Footer small */
.footer-small{margin-top:18px;color:var(--muted);font-size:13px}

/* Tiny responsive tweaks */
@media (max-width:600px){
  .logo{width:48px;height:48px}
  .avatar{width:44px;height:44px}
  .header h1{font-size:16px}
}
</style>
</head>
<body>

<div class="container">
  <div class="app">

    <!-- LEFT: tabs & forms -->
    <div class="panel" aria-hidden="false">
      <div class="header">
        <div class="logo">PW</div>
        <div>
          <h1>Ø³ÛŒØ³ØªÙ… Ú©Ø§Ø±Ø¨Ø± Ù‡Ø§</h1>
          <p>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…ØŒ ÙˆØ±ÙˆØ¯ Ùˆ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ </p>
        </div>
      </div>

      <div class="tabs" role="tablist" aria-label="auth-tabs">
        <button class="tab-btn active" id="tab-login">ÙˆØ±ÙˆØ¯</button>
        <button class="tab-btn" id="tab-register">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
        <button class="tab-btn" id="tab-profile" style="margin-left:auto;">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>
      </div>

      <!-- LOGIN -->
      <div id="form-login" class="form active" aria-labelledby="tab-login">
        <div class="field">
          <label for="login-user">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
          <input id="login-user" class="input" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø§ÛŒÙ…ÛŒÙ„" />
        </div>
        <div class="field">
          <label for="login-pass">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
          <input id="login-pass" type="password" class="input" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" />
        </div>
        <div class="field">
          <button class="btn" id="btn-login">ÙˆØ±ÙˆØ¯</button>
        </div>
        <div class="link-muted">
          <span id="login-msg" style="color:var(--danger)"></span>
        </div>
      </div>

      <!-- REGISTER -->
      <div id="form-register" class="form" aria-labelledby="tab-register">
        <div class="field">
          <label for="reg-user">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
          <input id="reg-user" class="input" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¯Ù„Ø®ÙˆØ§Ù‡" />
        </div>
        <div class="field">
          <label for="reg-pass">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
          <input id="reg-pass" type="password" class="input" placeholder="Ø±Ù…Ø² Ù‚ÙˆÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯" />
          <div class="strength" aria-hidden="true"><i id="strength-bar"></i></div>
        </div>
        <div class="field">
          <label for="reg-pass2">ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø²</label>
          <input id="reg-pass2" type="password" class="input" placeholder="Ø±Ù…Ø² Ø±Ø§ ØªÚ©Ø±Ø§Ø± Ú©Ù†ÛŒØ¯" />
        </div>

        <div class="field">
          <button class="btn" id="btn-register">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
        </div>
        <div class="hints">
          <ul style="margin:8px 0;padding-right:18px">
            <li>Ø±Ù…Ø² Ø­Ø¯Ø§Ù‚Ù„ Û¸ Ú©Ø§Ø±Ø§Ú©ØªØ±ØŒ Ø´Ø§Ù…Ù„ Ø­Ø±Ù Ùˆ Ø¹Ø¯Ø¯ Ùˆ Ù†Ù…Ø§Ø¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</li>
            <li>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.</li>
          </ul>
          <div id="reg-msg" style="color:var(--danger)"></div>
        </div>
      </div>

      <!-- PROFILE EDIT (small quick form for password change) -->
      <div id="form-profile" class="form" aria-labelledby="tab-profile" style="padding-top:8px">
        <div class="field">
          <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡:</label>
          <div id="current-username" class="small" style="font-weight:700;color:var(--accent)"></div>
        </div>
        <div class="field">
          <label for="chg-pass">ØªØºÛŒÛŒØ± Ø±Ù…Ø² (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²)</label>
          <input id="chg-pass" type="password" class="input" placeholder="Ø±Ù…Ø² Ø¬Ø¯ÛŒØ¯ â€” Ø®Ø§Ù„ÛŒ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯ Ø§Ú¯Ø± Ù†Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯" />
        </div>
        <div class="field">
          <button class="btn" id="btn-change-pass">Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ± Ø±Ù…Ø²</button>
        </div>
        <div class="hints">
          <div id="profile-msg" style="color:var(--danger)"></div>
          <div style="margin-top:10px" class="small">Ù‡Ù…Ú†Ù†ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ Ø¨Ø±ÙˆÛŒØ¯.</div>
        </div>
      </div>

    </div>

    <!-- RIGHT: main content / profile -->
    <div class="main" id="main-area">
      <div class="topbar">
        <div class="user-info">
          <div class="avatar" id="main-avatar">A</div>
          <div class="welcome">
            <h2 id="welcome-title">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</h2>
            <p id="welcome-sub">Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ Ù„Ø·ÙØ§Ù‹ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯ ÛŒØ§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯.</p>
          </div>
        </div>
        <div>
          <button id="open-dashboard" class="btn ghost" style="width:auto;padding:10px 14px">Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡</button>
        </div>
      </div>

      <div class="card" id="dashboard-card">
        <h3>Ù…Ø¹Ø±ÙÛŒ Ù…Ø§Ø´ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ</h3>
        <p class="small">Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ÛŒ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±Ù‡Ø§ Ùˆ Ø¯Ø³ØªÙˆØ± Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ø¢Ù†â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù… ÙˆØ¸Ø§ÛŒÙ Ù…Ø®ØªÙ„Ù Ù‡Ø³ØªÙ†Ø¯. Ø¯Ø± ÙˆØ§Ù‚Ø¹ØŒ ØªÙ…Ø§Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±ÛŒØŒ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ Ùˆ Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÚ†ÛŒØ¯Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø§Ù…Ø±ÙˆØ²Ù‡ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒÙ…ØŒ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ú©Ø¯Ù†ÙˆÛŒØ³ÛŒ Ø¨Ø§ Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ÛŒ Ø·Ø±Ø§Ø­ÛŒ Ùˆ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</p>

        <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:220px">
            <strong>ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§</strong>
            <ul style="margin-top:8px;color:var(--muted)">
              <li>ØµÙØ­Ù‡ Ú†Ù†Ø¯Ø¨Ø®Ø´ÛŒ Ùˆ Ù…Ø±ØªØ¨</li>
              <li>Ù‚Ø§Ø¨Ù„ÛŒØª Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ù…Ø²</li>
              <li>Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…Ø¯Ø±Ù† Ùˆ ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§</li>
            </ul>
          </div>

          <div style="flex:1;min-width:220px">
            <strong>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±</strong>
            <div style="margin-top:10px" id="info-block">
              <div style="font-size:14px;color:var(--muted)">ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡</div>
            </div>
            <div class="action-row" style="margin-top:8px">
              <button id="btn-logout" class="btn" style="background:var(--danger)">Ø®Ø±ÙˆØ¬</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
/* ---------- Helpers ---------- */

// Simple helper to show messages
function showMsg(el, text, timeout=4000){
  el.textContent = text;
  if(timeout>0){
    setTimeout(()=>{ if(el.textContent===text) el.textContent = ''; }, timeout);
  }
}

// SHA-256 hash using SubtleCrypto -> returns hex string
async function sha256Hex(str){
  const enc = new TextEncoder();
  const data = enc.encode(str);
  const hash = await crypto.subtle.digest('SHA-256', data);
  const bytes = Array.from(new Uint8Array(hash));
  return bytes.map(b => b.toString(16).padStart(2,'0')).join('');
}

/* ---------- Simple localStorage "DB" ---------- */
// users stored as array of {username, passHash}
const DB_KEY = 'app_users_v1';
const LOGIN_KEY = 'app_logged_user_v1';

function loadUsers(){
  try {
    return JSON.parse(localStorage.getItem(DB_KEY)) || [];
  } catch(e){
    return [];
  }
}
function saveUsers(users){
  localStorage.setItem(DB_KEY, JSON.stringify(users));
}
function findUser(username){
  const u = loadUsers(); return u.find(x => x.username.toLowerCase() === username.toLowerCase());
}

/* ---------- UI elements ---------- */
const tabLogin = document.getElementById('tab-login');
const tabRegister = document.getElementById('tab-register');
const tabProfile = document.getElementById('tab-profile');

const formLogin = document.getElementById('form-login');
const formRegister = document.getElementById('form-register');
const formProfile = document.getElementById('form-profile');

const loginUser = document.getElementById('login-user');
const loginPass = document.getElementById('login-pass');
const btnLogin = document.getElementById('btn-login');
const loginMsg = document.getElementById('login-msg');

const regUser = document.getElementById('reg-user');
const regPass = document.getElementById('reg-pass');
const regPass2 = document.getElementById('reg-pass2');
const btnRegister = document.getElementById('btn-register');
const regMsg = document.getElementById('reg-msg');
const strengthBar = document.getElementById('strength-bar');

const currentUsername = document.getElementById('current-username');
const chgPass = document.getElementById('chg-pass');
const btnChangePass = document.getElementById('btn-change-pass');
const profileMsg = document.getElementById('profile-msg');

const infoBlock = document.getElementById('info-block');
const mainAvatar = document.getElementById('main-avatar');
const welcomeTitle = document.getElementById('welcome-title');
const welcomeSub = document.getElementById('welcome-sub');
const openDashboard = document.getElementById('open-dashboard');
const btnLogout = document.getElementById('btn-logout');

/* ---------- Tab behavior ---------- */
function activateTab(tab){
  [tabLogin,tabRegister,tabProfile].forEach(t=>t.classList.remove('active'));
  [formLogin,formRegister,formProfile].forEach(f=>f.classList.remove('active'));
  if(tab === 'login'){ tabLogin.classList.add('active'); formLogin.classList.add('active'); }
  if(tab === 'register'){ tabRegister.classList.add('active'); formRegister.classList.add('active'); }
  if(tab === 'profile'){ tabProfile.classList.add('active'); formProfile.classList.add('active'); }
}
tabLogin.addEventListener('click', ()=>activateTab('login'));
tabRegister.addEventListener('click', ()=>activateTab('register'));
tabProfile.addEventListener('click', ()=>activateTab('profile'));

/* ---------- Password strength (very simple heuristic) ---------- */
function calcStrength(p){
  let score = 0;
  if(p.length >= 8) score += 1;
  if(/[A-Z\u0600-\u06FF]/.test(p)) score += 1; // uppercase or persian letters
  if(/[0-9]/.test(p)) score += 1;
  if(/[^A-Za-z0-9\u0600-\u06FF]/.test(p)) score += 1; // symbol
  return score; // 0..4
}
function updateStrengthUI(){
  const v = regPass.value || '';
  const s = calcStrength(v);
  const pct = (s/4)*100;
  strengthBar.style.width = pct + '%';
  if(s<=1) strengthBar.style.background = 'linear-gradient(90deg,#ff4d4f,#ff7a18)';
  else if(s===2) strengthBar.style.background = 'linear-gradient(90deg,#ffb800,#ffd200)';
  else if(s===3) strengthBar.style.background = 'linear-gradient(90deg,#00b894,#00d4a6)';
  else strengthBar.style.background = 'linear-gradient(90deg,#00b894,#0066cc)';
}
regPass.addEventListener('input', updateStrengthUI);

/* ---------- Registration ---------- */
btnRegister.addEventListener('click', async function(){
  regMsg.textContent = '';
  const username = regUser.value.trim();
  const pass = regPass.value;
  const pass2 = regPass2.value;

  if(!username || !pass || !pass2){
    showMsg(regMsg, 'Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯');
    return;
  }
  if(pass !== pass2){
    showMsg(regMsg, 'Ø±Ù…Ø² Ùˆ ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² ÛŒÚ©Ø³Ø§Ù† Ù†ÛŒØ³ØªÙ†Ø¯');
    return;
  }
  if(pass.length < 6){
    showMsg(regMsg, 'Ø±Ù…Ø² Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
    return;
  }
  if(findUser(username)){
    showMsg(regMsg, 'Ø§ÛŒÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª');
    return;
  }

  // create hash
  const hash = await sha256Hex(pass);
  const users = loadUsers();
  users.push({ username, passHash: hash, created: new Date().toISOString() });
  saveUsers(users);

  showMsg(regMsg, 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ âœ…', 5000);
  // clear fields
  regUser.value=''; regPass.value=''; regPass2.value='';
  updateStrengthUI();
  // switch to login
  activateTab('login');
});

/* ---------- Login ---------- */
btnLogin.addEventListener('click', async function(){
  loginMsg.textContent = '';
  const username = loginUser.value.trim();
  const pass = loginPass.value;
  if(!username || !pass){ showMsg(loginMsg, 'Ù„Ø·ÙØ§Ù‹ Ù‡Ø± Ø¯Ùˆ ÙÛŒÙ„Ø¯ Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ù†ÛŒØ¯'); return; }

  // check admin test credentials shortcut
  if(username === 'admin' && pass === '123456'){
    // ensure admin exists in DB (optional)
    const users = loadUsers();
    if(!users.some(u=>u.username.toLowerCase() === 'admin')){
      const h = await sha256Hex('123456');
      users.push({ username:'admin', passHash:h, created:new Date().toISOString() });
      saveUsers(users);
    }
    localStorage.setItem(LOGIN_KEY, 'admin');
    refreshUI();
    activateTab('profile');
    showMsg(loginMsg, 'ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 3000);
    return;
  }

  const user = findUser(username);
  if(!user){ showMsg(loginMsg, 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯'); return; }

  const hash = await sha256Hex(pass);
  if(hash !== user.passHash){ showMsg(loginMsg, 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª'); return; }

  localStorage.setItem(LOGIN_KEY, user.username);
  refreshUI();
  activateTab('profile');
  showMsg(loginMsg, 'ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 2500);
});

/* ---------- Change password (profile) ---------- */
btnChangePass.addEventListener('click', async function(){
  profileMsg.textContent = '';
  const newPass = chgPass.value;
  const logged = localStorage.getItem(LOGIN_KEY);
  if(!logged){ showMsg(profileMsg, 'Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯'); return; }
  if(!newPass || newPass.length < 6){ showMsg(profileMsg, 'Ø±Ù…Ø² Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ±)'); return; }

  const users = loadUsers();
  const idx = users.findIndex(u=>u.username.toLowerCase() === logged.toLowerCase());
  if(idx === -1){ showMsg(profileMsg, 'Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯'); return; }

  users[idx].passHash = await sha256Hex(newPass);
  saveUsers(users);
  chgPass.value = '';
  showMsg(profileMsg, 'Ø±Ù…Ø² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ âœ…', 4000);
});

/* ---------- Logout ---------- */
function logout(){
  localStorage.removeItem(LOGIN_KEY);
  refreshUI();
  activateTab('login');
  showMsg(loginMsg, 'Ø®Ø±ÙˆØ¬ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 2000);
}
btnLogout.addEventListener('click', logout);

/* ---------- UI refresh with logged user ---------- */
function refreshUI(){
  const logged = localStorage.getItem(LOGIN_KEY);
  if(logged){
    // show user info in main area
    mainAvatar.textContent = logged.charAt(0).toUpperCase();
    welcomeTitle.textContent = `Ø³Ù„Ø§Ù…ØŒ ${logged} ğŸ‘‹`;
    welcomeSub.textContent = 'Ø´Ù…Ø§ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!';
    currentUsername.textContent = logged;
    infoBlock.innerHTML = `<div style="font-weight:600;color:#0b1220">${logged}</div>
                           <div style="font-size:13px;color:var(--muted);margin-top:6px">Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯: Ù‡Ù… Ø§Ú©Ù†ÙˆÙ†</div>`;
  } else {
    mainAvatar.textContent = 'A';
    welcomeTitle.textContent = 'Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!';
    welcomeSub.textContent = 'Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ Ù„Ø·ÙØ§Ù‹ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯ ÛŒØ§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯.';
    currentUsername.textContent = 'ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡';
    infoBlock.innerHTML = `<div style="font-size:14px;color:var(--muted)">Ù‡ÛŒÚ† Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡</div>`;
  }
}

/* ---------- Dashboard open button ---------- */
openDashboard.addEventListener('click', function(){
  const logged = localStorage.getItem(LOGIN_KEY);
  if(!logged){
    activateTab('login');
    showMsg(loginMsg, 'Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
    return;
  }
  // scroll to dashboard card (for single page UX)
  document.getElementById('dashboard-card').scrollIntoView({behavior:'smooth'});
});

/* ---------- initialize sample admin (if none) ---------- */
(async function init(){
  // create admin sample if DB empty (so user can test)
  const users = loadUsers();
  if(users.length === 0){
    const h = await sha256Hex('123456');
    users.push({username:'admin', passHash:h, created:new Date().toISOString()});
    saveUsers(users);
  }
  refreshUI();

  // if logged, open profile tab
  if(localStorage.getItem(LOGIN_KEY)){
    activateTab('profile');
  } else {
    activateTab('login');
  }
})();

/* ---------- keyboard: enter to submit in forms ---------- */
[loginUser, loginPass].forEach(inp => inp.addEventListener('keydown', e=>{
  if(e.key === 'Enter') btnLogin.click();
}));
[regUser, regPass, regPass2].forEach(inp => inp.addEventListener('keydown', e=>{
  if(e.key === 'Enter') btnRegister.click();
}));
</script>
</body>
</html>
